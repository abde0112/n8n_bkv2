{
  "updatedAt": "2025-09-20T12:08:43.000Z",
  "createdAt": "2025-09-20T12:08:43.406Z",
  "id": "5LRVDjE43WW5lrGZ",
  "name": "RAG CHAT-BOT (TELEGRAM)",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Listen for incoming events').first().json.message.from.id }}"
      },
      "id": "dfb4099f-182c-4bf6-810d-c2364a97e338",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        320,
        496
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "0a84e9dd-b976-4136-b5bd-202ca45c9074",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        176,
        512
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "efe71fd6-d825-4156-8647-951e8a038a52",
      "name": "Listen for incoming events",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [
        -1024,
        64
      ],
      "webhookId": "322dce18-f93e-4f86-b9b1-3305519b7834",
      "typeVersion": 1
    },
    {
      "parameters": {
        "chatId": "={{ $('Listen for incoming events').first().json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "7d99cec4-9d48-4656-b23e-92d60c55e341",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        544,
        224
      ],
      "webhookId": "e699405e-8e52-4d38-a06b-1fa8edf050bd",
      "typeVersion": 1.1,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a0bf9719-4272-46f6-ab3b-eda6f7b44fd8",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.message.text }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "32990697-dded-47e7-80d4-e2975bace91d",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        -288,
        64
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "a92c40e4-6a67-462b-85ec-c79ef9735fb4",
      "name": "Speech to Text",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        192,
        16
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "text",
              "stringValue": "={{ $json?.message?.text || \"\" }}"
            }
          ]
        },
        "options": {}
      },
      "id": "aeca551a-8ee5-4518-b173-4dbd5b4407c0",
      "name": "Voice or Text",
      "type": "n8n-nodes-base.set",
      "position": [
        -768,
        64
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Listen for incoming events').item.json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "id": "72febc7e-010d-4b27-8cef-87ed08b7523e",
      "name": "Get Voice File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        0,
        0
      ],
      "webhookId": "24273e7e-6133-415e-8627-a9d6dc0f107c",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $json.message.from.id }}",
            "message": "={{ $json.message.text }}",
            "timestamp": "={{ $now }}",
            "User_name": "={{ $json.message.from.first_name }}  {{ $json.message.from.last_name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "User_name",
              "displayName": "User_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ai_response",
              "displayName": "ai_response",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -432,
        560
      ],
      "id": "149688b5-c1e1-4963-b56d-d48e5404a1e9",
      "name": "Append row in sheet"
    },
    {
      "parameters": {
        "jsCode": "const history = items.map(i => `User: ${i.json.message}\\nAI: ${i.json.ai_response || \"(not answered yet)\"}`).join(\"\\n\");\nreturn [{ json: { session_history: history } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        544
      ],
      "id": "f6dab64e-3fec-47d7-b6a9-2500f62c3522",
      "name": "return last messages"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw",
          "mode": "list",
          "cachedResultName": "AI Customer Support Chat for Web Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 609017273,
          "mode": "list",
          "cachedResultName": "Domains",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=609017273"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1008,
        464
      ],
      "id": "e812d265-733a-41a9-92c2-714194ff8f41",
      "name": "Domains"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw",
          "mode": "list",
          "cachedResultName": "AI Customer Support Chat for Web Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 328675267,
          "mode": "list",
          "cachedResultName": "Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=328675267"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -848,
        464
      ],
      "id": "12039780-ed56-4f11-ad46-e424eefd2c02",
      "name": "Hosting"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw",
          "mode": "list",
          "cachedResultName": "AI Customer Support Chat for Web Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1189409887,
          "mode": "list",
          "cachedResultName": "FAQs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=1189409887"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -576,
        544
      ],
      "id": "137b23db-ffe7-42d9-981d-ca7fda8ee666",
      "name": "Get row(s) in sheet"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw",
          "mode": "list",
          "cachedResultName": "AI Customer Support Chat for Web Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "user",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "user_id",
              "lookupValue": "={{ $('Listen for incoming events').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -272,
        544
      ],
      "id": "6daa99c0-a9d4-408e-9194-5ea64e164061",
      "name": "User",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=You are a friendly and professional web hosting sales assistant. \nAll the hosting, WordPress, domain pricing, and FAQ data is stored in your memory. Use it to answer questions accurately. \n\nRules:\n1. Always check your memory first before answering. \n2. Answer questions about hosting plans, WordPress setup, domain prices, and availability.\n3. Use the session history to maintain context of the conversation.\n4. Suggest suitable hosting plans if the user wants to buy.\n5. If the user asks about domains, tell them the availability status if known, or price if applicable.\n6. Be polite, concise, and persuasive when suggesting plans.\n7. If unsure, say: \"Iâ€™ll get a human agent to assist you further.\"\n\nInputs from n8n:\n- User message:\n- Session history: \n- Optional: Domain check: \n- Memory: All hosting plans, WordPress plans, pricing, and FAQs\n\nOutput:\n- A clear, helpful, and natural message to send back to the Telegram user.\n- If user asks for a PDF or pricing table, refer to the PDF if available.\n"
        }
      },
      "id": "19b14794-339f-460c-a6fd-121b958c5b4f",
      "name": "AI",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        160,
        304
      ],
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw",
          "mode": "list",
          "cachedResultName": "AI Customer Support Chat for Web Hosting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1189409887,
          "mode": "list",
          "cachedResultName": "FAQs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1L4YE7zWcKJrnvWJ0kbyD5H189XasuKqLRHG8nv03rgw/edit#gid=1189409887"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -560,
        64
      ],
      "id": "cec439e0-b895-42a9-93bf-605be09214f5",
      "name": "FAQ's"
    }
  ],
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Get Voice File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Domains",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Voice or Text": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          },
          {
            "node": "FAQ's",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Voice File": {
      "main": [
        [
          {
            "node": "Speech to Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Speech to Text": {
      "main": [
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Listen for incoming events": {
      "main": [
        [
          {
            "node": "Voice or Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Domains": {
      "main": [
        [
          {
            "node": "Hosting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hosting": {
      "main": [
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User": {
      "main": [
        [
          {
            "node": "return last messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "b1d850ab-1d25-4a40-945c-477f1224cf20",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-09-20T12:08:43.423Z",
      "createdAt": "2025-09-20T12:08:43.423Z",
      "role": "workflow:owner",
      "workflowId": "5LRVDjE43WW5lrGZ",
      "projectId": "HHopAZ4lOFgjhBzT"
    }
  ],
  "activeVersion": null,
  "tags": []
}