{
  "updatedAt": "2025-10-28T11:25:20.000Z",
  "createdAt": "2025-10-14T19:08:26.461Z",
  "id": "Yi3Aqig5H01rXT9H",
  "name": "Day15:Face-Brain Link",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "frontend",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "5229771f-9aaa-4b3a-80f7-e297209487f3",
      "name": "Webhook",
      "webhookId": "afd3efbd-122f-49ad-8baf-c0d32eecbc14"
    },
    {
      "parameters": {
        "url": "=https://fakestoreapi.com/products/{{ $json.body.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        320,
        0
      ],
      "id": "6fec9a24-ff8b-4018-a7b5-b19cd450441e",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are an inclusive product description assistant.\n\nWrite a **short, friendly, one-line summary** for a product.\nInclude:\n- The product title\n- Price\n- One **unique or special feature** of the product\nKeep it:\n- Concise (1 sentence)\n- Easy to read\n- Accessible to everyone\n- Avoid marketing fluff\n\nProduct data:\nproduct_id: {{ $json.id }}\nTitle: {{ $json.title }}\nPrice: {{ $json.price }}\nDescription: {{ $json.description }}\nCategory:{{ $json.category }}\n",
        "options": {
          "systemMessage": "You are a friendly product guide. Describe products in simple terms.\n\nWrite a brief description that answers: \"What is this product and how much does it cost?\"\n\nUse natural, everyday language. Be concise but helpful.\nFormat: 1-2 short sentences."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        608,
        0
      ],
      "id": "487a615d-935f-40d1-ae8d-5015e1b39970",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        576,
        240
      ],
      "id": "99e89b6a-c08b-402b-a27f-a7ca1286541c",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "SX4TgzNyXd9nY9M1",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the message from webhook payload\nconst webhookData = $input.first().json;\nconst message = webhookData.message || webhookData.body?.message || '';\n\n// Extract the ID from the message using regex\n// This will find numbers in the message\nconst idMatch = message.match(/\\d+/);\n\n// Check if we found an ID\nif (!idMatch) {\n  throw new Error('No ID found in message');\n}\n\nconst productId = idMatch[0];\n\n// Pass it to the next node (HTTP Request)\nreturn [{\n  json: {\n    productId: productId\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        240
      ],
      "id": "6458462f-5fbb-45b6-a687-9464a4dae58c",
      "name": "Extract ID",
      "disabled": true
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, GET, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, ngrok-skip-browser-warning"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1552,
        0
      ],
      "id": "ee6318b1-5f93-4c28-98ab-f6f22e02b7b4",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Product Card</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 100vh;\n            padding: 20px;\n        }\n\n        .product-card {\n            background: white;\n            border-radius: 20px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n            max-width: 450px;\n            width: 100%;\n            overflow: hidden;\n            transition: transform 0.3s ease;\n        }\n\n        .product-card:hover {\n            transform: translateY(-10px);\n        }\n\n        .product-image {\n            width: 100%;\n            height: 300px;\n            object-fit: contain;\n            background: #f8f9fa;\n            padding: 20px;\n        }\n\n        .product-content {\n            padding: 25px;\n        }\n\n        .product-category {\n            display: inline-block;\n            background: #667eea;\n            color: white;\n            padding: 5px 15px;\n            border-radius: 20px;\n            font-size: 12px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            margin-bottom: 15px;\n        }\n\n        .product-title {\n            font-size: 22px;\n            font-weight: bold;\n            color: #2d3748;\n            margin-bottom: 15px;\n            line-height: 1.4;\n        }\n\n        .product-summary {\n            background: #f7fafc;\n            padding: 15px;\n            border-radius: 10px;\n            border-left: 4px solid #667eea;\n            margin-bottom: 15px;\n        }\n\n        .product-summary p {\n            color: #4a5568;\n            font-size: 14px;\n            line-height: 1.6;\n            margin: 0;\n        }\n\n        .product-description {\n            color: #718096;\n            font-size: 14px;\n            line-height: 1.6;\n            margin-bottom: 20px;\n        }\n\n        .product-footer {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding-top: 20px;\n            border-top: 2px solid #e2e8f0;\n            margin-bottom: 20px;\n        }\n\n        .product-price {\n            font-size: 32px;\n            font-weight: bold;\n            color: #667eea;\n        }\n\n        .product-rating {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .stars {\n            color: #fbbf24;\n            font-size: 18px;\n        }\n\n        .rating-text {\n            color: #718096;\n            font-size: 14px;\n        }\n\n        .audio-player {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            padding: 15px;\n            border-radius: 10px;\n            margin-bottom: 15px;\n        }\n\n        .audio-player audio {\n            width: 100%;\n            height: 40px;\n            border-radius: 5px;\n        }\n\n        .audio-label {\n            color: white;\n            font-size: 12px;\n            margin-bottom: 8px;\n            display: block;\n            font-weight: 500;\n            letter-spacing: 0.5px;\n        }\n\n        .product-id {\n            background: #f7fafc;\n            padding: 10px;\n            text-align: center;\n            color: #718096;\n            font-size: 12px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"product-card\">\n        <img src=\"{{$json.image_url}}\" alt=\"{{name}}\" class=\"product-image\">\n        \n        <div class=\"product-content\">\n            <span class=\"product-category\">{{$json.category}}</span>\n            <h2 class=\"product-title\">{{$json.name}}</h2>\n            \n            <!-- AI Summary Section -->\n            <div class=\"product-summary\">\n                <p>{{$json.textSummary}}</p>\n            </div>\n            \n            <p class=\"product-description\">{{$json.description}}</p>\n            \n            <div class=\"product-footer\">\n                <div class=\"product-price\">{{$json.price}}</div>\n                <div class=\"product-rating\">\n                    <span class=\"stars\">â˜…â˜…â˜…â˜…â˜†</span>\n                    <span class=\"rating-text\">({{$json.rating_count}})</span>\n                </div>\n            </div>\n\n            <!-- Audio Player -->\n            <div class=\"audio-player\">\n                <label class=\"audio-label\">ðŸ”Š Listen to Product Summary</label>\n                <audio id=\"audioPlayer\" controls preload=\"metadata\">\n                    <source src=\"{{$json.audioURL}}\" type=\"audio/mpeg\">\n                    Your browser does not support the audio element.\n                </audio>\n            </div>\n        </div>\n        \n        <div class=\"product-id\">Product ID: {{$json.product_id}}</div>\n    </div>\n</body>\n</html>"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        1488,
        432
      ],
      "id": "1b74ec2c-dbed-4381-92fd-807283c031c8",
      "name": "HTML",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Get AI summary\nconst aiOutput = $('AI Agent').first().json;\nconst textSummary = aiOutput.output || aiOutput.text || aiOutput.message;\n\n// Get product data\nconst productData = $('HTTP Request').first().json;\n\n// Get audio URL from Supabase HTTP Request1\nconst supabaseResponse = $('HTTP Request1').first().json;\nconst audioKey = supabaseResponse.Key;\n\n// Build the public Supabase URL\n// Replace YOUR_PROJECT_ID with your actual Supabase project ID\nconst audioURL = `https://rkkjqnmqtpvkllrgzftx.supabase.co/storage/v1/object/public/${audioKey}`;\n\nconsole.log('Final Audio URL:', audioURL);\n\n// Prepare data for HTML template\nreturn [{\n  json: {\n    product_id: productData.id,\n    name: productData.title,\n    price: `$${productData.price}`,\n    category: productData.category,\n    description: productData.description,\n    image_url: productData.image,\n    rating_count: productData.rating?.count || 0,\n    rating_rate: productData.rating?.rate || 0,\n    textSummary: textSummary,\n    audioURL: audioURL\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        432
      ],
      "id": "7b1555a9-558a-4375-8dd0-5d0ccee993b1",
      "name": "Prepare HTML data",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://rkkjqnmqtpvkllrgzftx.supabase.co/storage/v1/object/audio-files/product-audio-{{ $('HTTP Request').item.json.id }}.mp3",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey"
            },
            {
              "name": "Content-Type",
              "value": "audio/mpeg"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1104,
        0
      ],
      "id": "03d7f475-7f9b-4b3e-a59a-f731d541b9db",
      "name": "HTTP Request1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "YTvEKWVxiYMwfTzj",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all the data from previous nodes\nconst productData = $('HTTP Request').first().json;\nconst aiOutput = $('AI Agent').first().json;\nconst supabaseResponse = $('HTTP Request1').first().json;\n\n// Build the audio URL\nconst audioKey = supabaseResponse.Key;\nconst audioURL = `https://rkkjqnmqtpvkllrgzftx.supabase.co/storage/v1/object/public/${audioKey}`;\n\n// Extract the raw text from the AI Agent output\n// Use fallbacks based on common AI node outputs\nconst aiSummaryText = aiOutput.output || aiOutput.text || aiOutput.message || \"No summary available\";\n\n// Return JSON response for the frontend\n// The structure MUST match the 'Product' interface exactly for setProduct(data) to work.\nreturn [{\n  json: {\n    // Basic Product fields (must be flat and use exact names from 'Product' interface)\n    id: productData.id,\n    title: productData.title, \n    description: productData.description,\n    category: productData.category,\n    price: productData.price,\n    image: productData.image, // Mapped from productData.image\n\n    // Rating fields (these are nested in the source data but flat in the target interface)\n    // The ProductCard component likely expects these flat values. \n    rating: productData.rating?.rate || 0,\n    ratingCount: productData.rating?.count || 0,\n    \n    // AI-generated fields (must use exact names: aiSummary and audioUrl)\n    aiSummary: aiSummaryText, // Mapped from ai_summary\n    audioUrl: audioURL // Mapped from audio_url\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1312,
        0
      ],
      "id": "7cc62094-9c7b-495b-90a3-bfb8d115f5e6",
      "name": "Prepare JSON Response"
    },
    {
      "parameters": {
        "url": "http://api.voicerss.org",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "e529ed32530e461ca82de116a6919fa8"
            },
            {
              "name": "hl",
              "value": "en-us"
            },
            {
              "name": "src",
              "value": "={{ $json.output }}"
            },
            {
              "name": "c",
              "value": "mp3"
            },
            {
              "name": "f",
              "value": "44khz_16bit_stereo"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "data.mp3"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        912,
        0
      ],
      "id": "06ece795-6458-493d-b9f1-7a4f00298415",
      "name": "voicerss.org"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "voicerss.org",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare HTML data": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Prepare JSON Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare JSON Response": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voicerss.org": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "1044c3ba-545a-4974-b3ee-eec657c180a3",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-10-14T19:08:26.550Z",
      "createdAt": "2025-10-14T19:08:26.550Z",
      "role": "workflow:owner",
      "workflowId": "Yi3Aqig5H01rXT9H",
      "projectId": "HHopAZ4lOFgjhBzT"
    }
  ],
  "activeVersion": null,
  "tags": []
}