{
  "updatedAt": "2025-10-27T08:56:13.000Z",
  "createdAt": "2025-10-26T22:01:38.656Z",
  "id": "GUrTShyVpLoARGXT",
  "name": "Invoice Automation System",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "milestone-completed",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "position": [
        48,
        -144
      ],
      "webhookId": "invoice-trigger",
      "name": "Webhook: Milestone Completed",
      "id": "88c1778b-1af7-4b0c-98d6-8f2e6fe0c053",
      "typeVersion": 2.1
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.code",
      "position": [
        256,
        -144
      ],
      "name": "Process Milestone Data",
      "id": "fa96f4a8-f2e5-4a10-8a19-b7c623d4b4c6",
      "typeVersion": 2
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qbDDKtyjUWyWS75GamxN1iFBh4elxfd6U__QSHdHl4w",
          "mode": "list",
          "cachedResultName": "Ark-x Days",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbDDKtyjUWyWS75GamxN1iFBh4elxfd6U__QSHdHl4w/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466283524,
          "mode": "list",
          "cachedResultName": "advance ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbDDKtyjUWyWS75GamxN1iFBh4elxfd6U__QSHdHl4w/edit#gid=1466283524"
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        448,
        -144
      ],
      "name": "Log Invoice to Google Sheets",
      "id": "10f496b4-8c24-4f91-8970-fb1f516a2931",
      "typeVersion": 4.7,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "jToedYDz95w6z3tL",
          "name": "Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "position": [
        656,
        -144
      ],
      "name": "Generate Invoice PDF HTML",
      "id": "7b19edf6-98aa-4405-adce-33b6297e472b",
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "htmlToPdf"
      },
      "type": "n8n-nodes-base.convertToFile",
      "position": [
        848,
        -144
      ],
      "name": "Convert to PDF",
      "id": "78cc054c-34af-45d5-b8d4-a54d74ea4a14",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "sendTo": "={{ $json.clientEmail }}",
        "subject": "=Invoice {{ $json.invoiceNumber }} - {{ $json.projectName }}",
        "message": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <h2 style=\"color: #2563eb;\">Invoice for {{ $json.milestoneName }}</h2>\n  \n  <p>Dear {{ $json.clientName }},</p>\n  \n  <p>Thank you for your continued partnership! We're pleased to share that the milestone <strong>{{ $json.milestoneName }}</strong> for project <strong>{{ $json.projectName }}</strong> has been successfully completed.</p>\n  \n  <div style=\"background: #eff6ff; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n    <p style=\"margin: 5px 0;\"><strong>Invoice Number:</strong> {{ $json.invoiceNumber }}</p>\n    <p style=\"margin: 5px 0;\"><strong>Amount Due:</strong> {{ $json.currency }} {{ $json.total.toFixed(2) }}</p>\n    <p style=\"margin: 5px 0;\"><strong>Due Date:</strong> {{ $json.dueDate }}</p>\n  </div>\n  \n  <p>Please find the detailed invoice attached to this email.</p>\n  \n  <p><strong>Payment Instructions:</strong></p>\n  <ul>\n    <li>Bank Transfer to Account: 1234567890</li>\n    <li>Reference: {{ $json.invoiceNumber }}</li>\n  </ul>\n  \n  <p>If you have any questions about this invoice, please don't hesitate to contact us.</p>\n  \n  <p>Best regards,<br>\n  <strong>Your Company Team</strong><br>\n  contact@yourcompany.com</p>\n  \n  <p style=\"font-size: 12px; color: #6b7280; margin-top: 30px;\">\n    This is an automated invoice generated by our system. Please do not reply to this email.\n  </p>\n</div>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "position": [
        1056,
        -144
      ],
      "name": "Send Invoice Email",
      "id": "8e87272d-628b-4cc2-894c-209a94f53778",
      "typeVersion": 2.1,
      "webhookId": "a3ea7194-306a-4ba0-b16b-6fec97d0764e",
      "credentials": {
        "gmailOAuth2": {
          "id": "kwQyExBG7xNmebmA",
          "name": "Gmail account 4"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        1248,
        -144
      ],
      "name": "Webhook Response",
      "id": "d3f83bf3-c1e3-4842-b09c-15c0fbadac3c",
      "typeVersion": 1.4
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.plaid.com/transactions/sync",
        "authentication": "basicAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "={{ $env.PLAID_ACCESS_TOKEN }}"
            },
            {
              "name": "cursor",
              "value": "={{ $env.PLAID_CURSOR || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        48,
        160
      ],
      "name": "Fetch Bank Transactions (Plaid)",
      "id": "f301078d-8ba7-4a4b-b162-6b14198e1497",
      "typeVersion": 4.2
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.code",
      "position": [
        256,
        160
      ],
      "name": "Match Invoice References",
      "id": "24e15a08-a961-4223-a80a-7229551595df",
      "typeVersion": 2
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "YOUR_SHEET_ID",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Invoices",
          "mode": "name"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Invoice Number",
              "lookupValue": "={{ $json.invoiceNumber }}"
            },
            {
              "lookupColumn": "Status",
              "lookupValue": "pending"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        448,
        160
      ],
      "name": "Find Matching Invoice",
      "id": "414c83bc-e7f8-4523-aec6-05c4ea224b42",
      "typeVersion": 4.7
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.Amount }}",
              "rightValue": "={{ $('Match Invoice References').item.json.amount }}",
              "operator": {
                "type": "number",
                "operation": "equals",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "position": [
        656,
        160
      ],
      "name": "Amount Matches?",
      "id": "74039632-a438-4c17-858e-20018b00fa9d",
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "YOUR_SHEET_ID",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Invoices",
          "mode": "name"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        848,
        64
      ],
      "name": "Mark Invoice as Paid",
      "id": "1d81d140-d936-42d6-9680-f411bc0e5ec1",
      "typeVersion": 4.7
    },
    {
      "parameters": {
        "sendTo": "={{ $json['Client Email'] }}",
        "subject": "=Payment Received - Invoice {{ $json['Invoice Number'] }}",
        "message": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <div style=\"background: #10b981; color: white; padding: 20px; border-radius: 8px 8px 0 0; text-align: center;\">\n    <h1 style=\"margin: 0;\">✓ Payment Received</h1>\n  </div>\n  \n  <div style=\"padding: 30px; background: white; border: 1px solid #e5e7eb; border-radius: 0 0 8px 8px;\">\n    <p>Dear {{ $json['Client Name'] }},</p>\n    \n    <p>Thank you! We've received your payment for invoice <strong>{{ $json['Invoice Number'] }}</strong>.</p>\n    \n    <div style=\"background: #f0fdf4; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n      <p style=\"margin: 5px 0;\"><strong>Invoice Number:</strong> {{ $json['Invoice Number'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Amount Paid:</strong> {{ $json['Currency'] }} {{ $json['Amount'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Payment Date:</strong> {{ $json['Paid Date'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Transaction ID:</strong> {{ $json['Transaction ID'] }}</p>\n    </div>\n    \n    <p>This invoice has been marked as <strong style=\"color: #10b981;\">PAID</strong> in our system.</p>\n    \n    <p>If you have any questions, please contact us at accounting@yourcompany.com</p>\n    \n    <p>Best regards,<br>\n    <strong>Your Company Accounting Team</strong></p>\n  </div>\n</div>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "position": [
        1056,
        64
      ],
      "name": "Send Payment Confirmation",
      "id": "3cbe8983-6158-4839-908b-a033c3117cbe",
      "typeVersion": 2.1,
      "webhookId": "b1dcbb5d-0aa7-4c19-89c1-e01c81913b51"
    },
    {
      "parameters": {
        "sendTo": "accounting@yourcompany.com",
        "subject": "=Payment Reconciliation Alert - {{ $json['Invoice Number'] }}",
        "message": "=<div style=\"font-family: monospace;\">\n  <h3>⚠️ Manual Review Required</h3>\n  \n  <p>A bank transaction was found with invoice reference, but the amount doesn't match:</p>\n  \n  <div style=\"background: #fef2f2; padding: 15px; border-left: 4px solid #ef4444; margin: 20px 0;\">\n    <p><strong>Invoice Number:</strong> {{ $('Match Invoice References').item.json.invoiceNumber }}</p>\n    <p><strong>Expected Amount:</strong> {{ $json['Currency'] }} {{ $json['Amount'] }}</p>\n    <p><strong>Transaction Amount:</strong> {{ $json['Currency'] }} {{ $('Match Invoice References').item.json.amount }}</p>\n    <p><strong>Difference:</strong> {{ $json['Currency'] }} {{ Math.abs($json['Amount'] - $('Match Invoice References').item.json.amount) }}</p>\n  </div>\n  \n  <p><strong>Transaction Details:</strong></p>\n  <ul>\n    <li>Transaction ID: {{ $('Match Invoice References').item.json.transactionId }}</li>\n    <li>Date: {{ $('Match Invoice References').item.json.date }}</li>\n    <li>Description: {{ $('Match Invoice References').item.json.description }}</li>\n  </ul>\n  \n  <p>Please review and reconcile manually.</p>\n</div>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "position": [
        848,
        256
      ],
      "name": "Alert: Amount Mismatch",
      "id": "b90d73fe-bee6-4f88-b151-446d542f549c",
      "typeVersion": 2.1,
      "webhookId": "a01ea378-83fa-45c3-a5c7-ab7aab57800b"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        48,
        464
      ],
      "name": "Schedule: Check Every 6 Hours",
      "id": "17ad27c9-1f09-4303-8244-c8a75160d832",
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "YOUR_SHEET_ID",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Invoices",
          "mode": "name"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Status",
              "lookupValue": "pending"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        256,
        464
      ],
      "name": "Get Overdue Invoices",
      "id": "c58d1799-c914-465f-a104-aaf58a9d678c",
      "typeVersion": 4.7
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\n\nreturn $input.all().filter(item => {\n  const due = new Date(item.json[\"Due Date\"]);\n  const status = item.json[\"Status\"];\n  if (status.toLowerCase() === \"paid\") return false;\n\n  const diffDays = Math.floor((today - due) / (1000 * 60 * 60 * 24));\n  if (diffDays > 0) {\n    item.json.daysPastDue = diffDays;\n    return true;\n  }\n  return false;\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "position": [
        448,
        464
      ],
      "name": "Filter Overdue",
      "id": "4fd9f6a5-900c-4c23-a9ab-46194a2dceae",
      "typeVersion": 2
    },
    {
      "parameters": {
        "sendTo": "={{ $json['Client Email'] }}",
        "subject": "=Payment Reminder - Invoice {{ $json['Invoice Number'] }} ({{ $json.daysPastDue }} days overdue)",
        "message": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <div style=\"background: #f59e0b; color: white; padding: 20px; border-radius: 8px 8px 0 0;\">\n    <h2 style=\"margin: 0;\">⏰ Payment Reminder</h2>\n  </div>\n  \n  <div style=\"padding: 30px; background: white; border: 1px solid #e5e7eb; border-radius: 0 0 8px 8px;\">\n    <p>Dear {{ $json['Client Name'] }},</p>\n    \n    <p>This is a friendly reminder that invoice <strong>{{ $json['Invoice Number'] }}</strong> is now <strong style=\"color: #f59e0b;\">{{ $json.daysPastDue }} days overdue</strong>.</p>\n    \n    <div style=\"background: #fffbeb; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #f59e0b;\">\n      <p style=\"margin: 5px 0;\"><strong>Invoice Number:</strong> {{ $json['Invoice Number'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Amount Due:</strong> {{ $json['Currency'] }} {{ $json['Amount'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Original Due Date:</strong> {{ $json['Due Date'] }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Days Past Due:</strong> {{ $json.daysPastDue }}</p>\n    </div>\n    \n    <p>If you've already made this payment, please disregard this reminder. Otherwise, please arrange payment at your earliest convenience.</p>\n    \n    <p><strong>Payment Instructions:</strong></p>\n    <ul>\n      <li>Bank Transfer to Account: 1234567890</li>\n      <li>Reference: {{ $json['Invoice Number'] }}</li>\n    </ul>\n    \n    <p>If you have any questions or concerns, please contact us immediately.</p>\n    \n    <p>Best regards,<br>\n    <strong>Your Company Accounting Team</strong><br>\n    accounting@yourcompany.com</p>\n  </div>\n</div>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "position": [
        656,
        464
      ],
      "name": "Send Overdue Reminder",
      "id": "32b0fd55-1ebd-458f-86b8-44f398479363",
      "typeVersion": 2.1,
      "webhookId": "f7ffc68c-73a7-4222-8983-72683cd791cb",
      "credentials": {
        "gmailOAuth2": {
          "id": "kwQyExBG7xNmebmA",
          "name": "Gmail account 4"
        }
      }
    }
  ],
  "connections": {
    "Webhook: Milestone Completed": {
      "main": [
        [
          {
            "node": "Process Milestone Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Milestone Data": {
      "main": [
        [
          {
            "node": "Log Invoice to Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Invoice to Google Sheets": {
      "main": [
        [
          {
            "node": "Generate Invoice PDF HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Invoice PDF HTML": {
      "main": [
        [
          {
            "node": "Convert to PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to PDF": {
      "main": [
        [
          {
            "node": "Send Invoice Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Invoice Email": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Bank Transactions (Plaid)": {
      "main": [
        [
          {
            "node": "Match Invoice References",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Match Invoice References": {
      "main": [
        [
          {
            "node": "Find Matching Invoice",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find Matching Invoice": {
      "main": [
        [
          {
            "node": "Amount Matches?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Amount Matches?": {
      "main": [
        [
          {
            "node": "Mark Invoice as Paid",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Alert: Amount Mismatch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark Invoice as Paid": {
      "main": [
        [
          {
            "node": "Send Payment Confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule: Check Every 6 Hours": {
      "main": [
        [
          {
            "node": "Get Overdue Invoices",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Overdue Invoices": {
      "main": [
        [
          {
            "node": "Filter Overdue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Overdue": {
      "main": [
        [
          {
            "node": "Send Overdue Reminder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "4febf92b-bdc6-4b2f-a4f1-989019825049",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-10-26T22:01:38.677Z",
      "createdAt": "2025-10-26T22:01:38.677Z",
      "role": "workflow:owner",
      "workflowId": "GUrTShyVpLoARGXT",
      "projectId": "HHopAZ4lOFgjhBzT"
    }
  ],
  "activeVersion": null,
  "tags": []
}